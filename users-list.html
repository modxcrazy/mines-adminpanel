<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Users List - Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
  <style>
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    body {
      background: #111;
      color: #fff;
      padding: 30px;
    }
    .container {
      max-width: 960px;
      margin: auto;
    }
    h2 {
      text-align: center;
      color: #00e5ff;
      margin-bottom: 20px;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .controls input, .controls select {
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 14px;
    }
    .user-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .user-card {
      background: #1e1e1e;
      border-left: 5px solid #00e5ff;
      padding: 20px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-info p {
      margin: 5px 0;
      font-size: 15px;
    }
    .block-btn {
      padding: 10px 16px;
      background-color: #ff1744;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .block-btn.unblock {
      background-color: #00e676;
    }
    .pagination {
      text-align: center;
      margin-top: 20px;
    }
    .pagination button {
      padding: 8px 12px;
      margin: 0 5px;
      background: #333;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .pagination button.active {
      background-color: #00e5ff;
      color: black;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>All Registered Users</h2>
    <div class="controls">
      <input type="text" id="searchInput" placeholder="Search by name/email..." oninput="renderUsers()">
      <select id="sortSelect" onchange="renderUsers()">
        <option value="">Sort by</option>
        <option value="name">Sort by Name</option>
        <option value="email">Sort by Email</option>
      </select>
    </div>
    <div id="userList" class="user-list"></div>
    <div class="pagination" id="pagination"></div>
  </div>

  <script src="firebase-config.js"></script>
  <script>
    const db = firebase.database();
    let allUsers = [];
    const USERS_PER_PAGE = 5;
    let currentPage = 1;

    function fetchUsers() {
      db.ref("users").on("value", (snapshot) => {
        const data = snapshot.val();
        allUsers = data ? Object.entries(data).map(([uid, user]) => ({ uid, ...user })) : [];
        renderUsers();
      });
    }

    function renderUsers() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const sort = document.getElementById("sortSelect").value;
      let filtered = allUsers.filter(user =>
        user.name?.toLowerCase().includes(search) || user.email?.toLowerCase().includes(search)
      );

      if (sort === "name") {
        filtered.sort((a, b) => (a.name || "").localeCompare(b.name || ""));
      } else if (sort === "email") {
        filtered.sort((a, b) => (a.email || "").localeCompare(b.email || ""));
      }

      const totalPages = Math.ceil(filtered.length / USERS_PER_PAGE);
      if (currentPage > totalPages) currentPage = 1;

      const start = (currentPage - 1) * USERS_PER_PAGE;
      const paginated = filtered.slice(start, start + USERS_PER_PAGE);

      const userList = document.getElementById("userList");
      userList.innerHTML = "";

      paginated.forEach(user => {
        const card = document.createElement("div");
        card.className = "user-card";
        const isBlocked = user.status === "blocked";
        card.innerHTML = `
          <div class="user-info">
            <p><strong>Name:</strong> ${user.name || "N/A"}</p>
            <p><strong>Email:</strong> ${user.email}</p>
            <p><strong>Status:</strong> ${user.status || "active"}</p>
            <p><strong>Registered:</strong> ${user.registrationDate || "N/A"}</p>
          </div>
          <button class="block-btn ${isBlocked ? 'unblock' : ''}" onclick="toggleBlock('${user.uid}', ${isBlocked})">
            ${isBlocked ? 'Unblock' : 'Block'}
          </button>
        `;
        userList.appendChild(card);
      });

      // Pagination buttons
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      for (let i = 1; i <= totalPages; i++) {
        pagination.innerHTML += `<button onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
      }
    }

    function changePage(page) {
      currentPage = page;
      renderUsers();
    }

    function toggleBlock(uid, isBlocked) {
      const newStatus = isBlocked ? "active" : "blocked";
      const confirmation = confirm(`Are you sure you want to ${isBlocked ? "unblock" : "block"} this user?`);
      if (!confirmation) return;

      db.ref("users/" + uid + "/status").set(newStatus)
        .then(() => alert(`User ${isBlocked ? "unblocked" : "blocked"} successfully.`))
        .catch(err => alert("Error: " + err.message));
    }

    fetchUsers();
  </script>
</body>
</html>
